
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<div id="map-heading">
  <p class="center">
    <label class="switch">
      <input type="checkbox" id="findme">
      <span class="slider round"></span>
    </label>
    &nbsp;&nbsp; Find me on the map
  </p>
</div>
<div id="map"/></div>
<script>


  var imageUrl1 = '{{ "/img/fairgrounds-map-1.png" | absURL }}',
    imageBounds = [[40.39768, -86.8837], [40.39523, -86.87626]],
    maxImageBounds = [[40.39790, -86.8837], [40.3948, -86.87626]],
    imageOptions = {
      opacity: 1,
    },
    mapOptions = {
      enableHighAccuracy: true
    };


  // 40.397674516978164, -86.88353016570049
  // 40.39558617779395, -86.87673634707778
  var imageUrl2 = '{{ "/img/fairgrounds-map-2.png" | absURL }}',
    imageBounds = [[40.39768, -86.8837], [40.39523, -86.87626]],
    maxImageBounds = [[40.39790, -86.8837], [40.3948, -86.87626]],
    imageOptions = {
      opacity: 1,
    },
    mapOptions = {
      enableHighAccuracy: true
    };

  // 40.396731869878025, -86.88160169310576
  var map = L.map('map').setView([40.3967, -86.8816], 19);

  map.setMaxBounds(maxImageBounds);
  map.setMaxZoom(26);
  map.setMinZoom(19);


  // 40.39687107555382, -86.87963779555744
  L.marker([40.3968, -86.8796]).addTo(map)
      .bindPopup('<b>Horse Arena</b><br>Somewhere near the center.')
      .openPopup();

  // var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  //   maxZoom: 19,
  //   opacity: 1,
  //   attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  // }).addTo(map);

  ovl1 = L.imageOverlay(imageUrl1, imageBounds, imageOptions);
  ovl2 = L.imageOverlay(imageUrl2, imageBounds, imageOptions);

  ovl1.addTo(map);

  map.on('zoomend', function() {
  var zoomlevel = map.getZoom();
      if (zoomlevel  <20){
          if (map.hasLayer(ovl2)) {
              map.removeLayer(ovl2);
          } else {
              console.log("no point layer active");
          }
      }
      if (zoomlevel >= 20){
          if (map.hasLayer(ovl2)){
              console.log("layer already added");
          } else {
              map.addLayer(ovl2);
          }
      }
  console.log("Current Zoom Level =" + zoomlevel)
  });

  if (!navigator.geolocation) {
      console.log("Your browser doesn't support geolocation feature!")
  } else {
      setInterval(() => {
          if (document.getElementById("findme").checked) {
            navigator.geolocation.getCurrentPosition(getPosition)
          }
      }, 5000);
  };


  map.on('click', onLocationClicked)

  function onLocationClicked(e) {
    L.marker(e.latlng).addTo(map)
      .bindPopup("Lat: " + e.latlng.lat + "<br>Lng: "+ e.latlng.lng).openPopup();
  }

  var marker, circle, lat, long, accuracy;

  function getPosition(position) {
    // console.log(position)
    lat = position.coords.latitude
    long = position.coords.longitude
    accuracy = position.coords.accuracy

    if (marker) {
        map.removeLayer(marker)
    }

    if (circle) {
        map.removeLayer(circle)
    }

    marker = L.marker([lat, long])
    circle = L.circle([lat, long], { radius: accuracy })

    var featureGroup = L.featureGroup([marker, circle]).addTo(map)

    map.fitBounds(featureGroup.getBounds())
    console.log("Your coordinate is: Lat: " + lat + " Long: " + long + " Accuracy: " + accuracy)
  }

</script>
